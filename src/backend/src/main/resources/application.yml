server:
  port: 8080

spring:
  application:
    name: mimimart-backend

  # MySQL 8.4.6 資料庫配置
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: ${DB_URL}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    hikari:
      minimum-idle: 5
      maximum-pool-size: 20
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      pool-name: MimiMart-HikariCP

  # JPA 配置 (MySQL 8 Dialect)
  jpa:
    database-platform: org.hibernate.dialect.MySQL8Dialect
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: true
        jdbc:
          batch_size: 20
    show-sql: ${JPA_SHOW_SQL}
    open-in-view: false

  # Flyway 配置
  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration

  # 郵件配置
  mail:
    host: ${MAIL_HOST}
    port: ${MAIL_PORT}
    username: ${MAIL_USERNAME}
    password: ${MAIL_PASSWORD}
    properties:
      mail:
        smtp:
          auth: ${MAIL_SMTP_AUTH}
          starttls:
            enable: ${MAIL_SMTP_STARTTLS}

# SpringDoc OpenAPI 配置
springdoc:
  api-docs:
    path: /swagger/v3/api-docs
  swagger-ui:
    path: /swagger/swagger-ui/index.html
    displayRequestDuration: true
    tryItOutEnabled: true
    defaultModelsExpandDepth: 1
    filter: false
    syntaxHighlight:
      theme: monokai
    # 注入自訂 JavaScript (暗色主題偵測器)
    use-root-path: true

application:
  version: @project.version@

# MimiMart 應用程式配置
app:
  base-url: ${APP_BASE_URL}
  frontend:
    url: ${APP_FRONTEND_URL:http://localhost:5173}
  cors:
    allowed-origins: ${CORS_ALLOWED_ORIGINS}
  # 測試端點配置 (僅開發/測試環境啟用)
  test-endpoints:
    enabled: ${APP_TEST_ENDPOINTS_ENABLED:false}

# JWT 認證配置
jwt:
  # JWT 簽名金鑰 (生產環境請使用環境變數覆蓋)
  # 生成指令: openssl rand -base64 64
  secret: ${JWT_SECRET}
  # Access Token 有效期 (毫秒) - 會員 15 分鐘, 管理員 30 分鐘
  member-access-token-expiration: ${JWT_MEMBER_ACCESS_EXPIRATION}
  admin-access-token-expiration: ${JWT_ADMIN_ACCESS_EXPIRATION}
  # Refresh Token 有效期 (毫秒) - 7 天
  refresh-token-expiration: ${JWT_REFRESH_EXPIRATION}

# Mailpit 測試郵件服務配置 (可選)
mailpit:
  api-url: ${MAILPIT_API_URL}

# AWS S3 配置
aws:
  region: ${AWS_REGION}
  s3:
    bucket-name: ${S3_BUCKET_NAME}
    public-bucket-name: ${S3_PUBLIC_BUCKET_NAME}
    public-base-url: ${S3_PUBLIC_BASE_URL}
  credentials:
    access-key-id: ${AWS_ACCESS_KEY_ID}
    secret-access-key: ${AWS_SECRET_ACCESS_KEY}

# MimiMart 業務配置
mimimart:
  # 付款配置
  payment:
    expiration-minutes: 30  # 付款期限(分鐘)
    expired-check-cron: "0 */5 * * * ?"  # 逾期檢查排程(每5分鐘)
  # ECPay 綠界金流配置
  ecpay:
    merchant-id: ${ECPAY_MERCHANT_ID}
    hash-key: ${ECPAY_HASH_KEY}
    hash-iv: ${ECPAY_HASH_IV}
    api-url: ${ECPAY_API_URL}
    return-url: ${ECPAY_RETURN_URL}
    callback-url: ${ECPAY_CALLBACK_URL}

# 日誌配置
logging:
  level:
    root: ${LOG_LEVEL_ROOT}
    com.mimimart: ${LOG_LEVEL_APP}
    org.springframework.web: ${LOG_LEVEL_WEB}
    org.hibernate.SQL: ${LOG_LEVEL_SQL}
    org.hibernate.type.descriptor.sql.BasicBinder: ${LOG_LEVEL_SQL_BINDER}
